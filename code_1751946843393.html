<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>百科矩阵·人物词条模板生成器</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docx@8.2.2/build/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --light-bg: #f8f9fa;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .main-container {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            margin: 20px auto;
            max-width: 1400px;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            margin: 0.5rem 0 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .nav-tabs {
            border-bottom: 3px solid var(--secondary-color);
            background: var(--light-bg);
            padding: 0 1rem;
        }

        .nav-tabs .nav-link {
            border: none;
            color: var(--primary-color);
            font-weight: 600;
            padding: 1rem 1.5rem;
            margin-right: 0.5rem;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }

        .nav-tabs .nav-link:hover {
            background: rgba(52, 152, 219, 0.1);
            color: var(--secondary-color);
        }

        .nav-tabs .nav-link.active {
            background: white;
            color: var(--secondary-color);
            border-bottom: 3px solid var(--secondary-color);
        }

        .person-type-selector {
            background: white;
            padding: 2rem;
            border-bottom: 1px solid #dee2e6;
        }

        .type-card {
            border: 2px solid #e9ecef;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            height: 100%;
            text-align: center;
        }

        .type-card:hover {
            border-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: var(--card-shadow);
        }

        .type-card.active {
            border-color: var(--secondary-color);
            background: rgba(52, 152, 219, 0.05);
            box-shadow: var(--card-shadow);
        }

        .type-card i {
            font-size: 2rem;
            color: var(--secondary-color);
            margin-bottom: 1rem;
        }

        .form-section {
            background: white;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            box-shadow: var(--card-shadow);
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 1rem 1.5rem;
            font-weight: 600;
            font-size: 1.2rem;
        }

        .section-content {
            padding: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .form-control, .form-select {
            border-radius: 8px;
            border: 2px solid #e9ecef;
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
        }

        .timeline-item, .list-item {
            background: var(--light-bg);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--secondary-color);
        }

        .add-item-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .add-item-btn:hover {
            background: var(--primary-color);
            transform: translateY(-1px);
        }

        .remove-item-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
        }

        .preview-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--card-shadow);
            font-family: 'Times New Roman', serif;
            line-height: 1.6;
        }

        .preview-title {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 2rem;
            color: var(--primary-color);
        }

        .preview-section {
            margin-bottom: 2rem;
        }

        .preview-section h3 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }

        .export-buttons {
            position: sticky;
            bottom: 20px;
            text-align: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
        }

        .export-btn {
            margin: 0 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--card-shadow);
        }

        .progress-indicator {
            background: var(--light-bg);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
        }

        .progress {
            height: 8px;
            border-radius: 4px;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            text-align: center;
        }

        @media (max-width: 768px) {
            .main-container {
                margin: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .type-card {
                margin-bottom: 1rem;
            }
            
            .section-content {
                padding: 1rem;
            }
        }

        .reference-tag {
            display: inline-block;
            background: var(--secondary-color);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            margin: 0 0.2rem;
            cursor: pointer;
        }

        .help-text {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 0.5rem;
        }

        .required-field::after {
            content: " *";
            color: var(--accent-color);
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="main-container">
            <!-- 头部 -->
            <div class="header">
                <h1><i class="bi bi-person-badge"></i> 百科矩阵·人物词条模板生成器</h1>
                <p>专业的人物百科词条创建工具，支持多种人物类型和格式导出</p>
            </div>

            <!-- 导航标签 -->
            <ul class="nav nav-tabs" id="mainTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="form-tab" data-bs-toggle="tab" data-bs-target="#form-panel" type="button" role="tab">
                        <i class="bi bi-pencil-square"></i> 内容填写
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="preview-tab" data-bs-toggle="tab" data-bs-target="#preview-panel" type="button" role="tab">
                        <i class="bi bi-eye"></i> 实时预览
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="export-tab" data-bs-toggle="tab" data-bs-target="#export-panel" type="button" role="tab">
                        <i class="bi bi-download"></i> 导出下载
                    </button>
                </li>
            </ul>

            <div class="tab-content" id="mainTabContent">
                <!-- 表单填写面板 -->
                <div class="tab-pane fade show active" id="form-panel" role="tabpanel">
                    <!-- 人物类型选择 -->
                    <div class="person-type-selector">
                        <h3 class="mb-4"><i class="bi bi-person-lines-fill"></i> 选择人物类型</h3>
                        <div class="row" id="personTypeCards">
                            <!-- 动态生成人物类型卡片 -->
                        </div>
                    </div>

                    <!-- 进度指示器 -->
                    <div class="container">
                        <div class="progress-indicator">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span><i class="bi bi-clipboard-check"></i> 填写进度</span>
                                <span id="progressText">0%</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar bg-success" id="progressBar" role="progressbar" style="width: 0%"></div>
                            </div>
                        </div>

                        <!-- 表单区域 -->
                        <div id="formSections">
                            <!-- 动态生成表单内容 -->
                        </div>
                    </div>
                </div>

                <!-- 预览面板 -->
                <div class="tab-pane fade" id="preview-panel" role="tabpanel">
                    <div class="container">
                        <div class="preview-container" id="previewContent">
                            <div class="preview-title" id="previewTitle">人物百科词条</div>
                            <div id="previewSections">
                                <!-- 动态生成预览内容 -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 导出面板 -->
                <div class="tab-pane fade" id="export-panel" role="tabpanel">
                    <div class="container">
                        <div class="row justify-content-center">
                            <div class="col-md-8">
                                <div class="form-section">
                                    <div class="section-header">
                                        <i class="bi bi-download"></i> 导出选项
                                    </div>
                                    <div class="section-content text-center">
                                        <h4 class="mb-4">选择导出格式</h4>
                                        <div class="row mb-4">
                                            <div class="col-md-4 mb-3">
                                                <button class="btn btn-primary export-btn w-100" onclick="exportToWord()">
                                                    <i class="bi bi-file-earmark-word"></i><br>
                                                    Word文档<br>
                                                    <small>(.docx)</small>
                                                </button>
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <button class="btn btn-danger export-btn w-100" onclick="exportToPDF()">
                                                    <i class="bi bi-file-earmark-pdf"></i><br>
                                                    PDF文档<br>
                                                    <small>(.pdf)</small>
                                                </button>
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <button class="btn btn-success export-btn w-100" onclick="exportToText()">
                                                    <i class="bi bi-file-earmark-text"></i><br>
                                                    纯文本<br>
                                                    <small>(.txt)</small>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <hr class="my-4">
                                        
                                        <h5 class="mb-3">模板导出</h5>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <button class="btn btn-outline-secondary w-100" onclick="exportEmptyTemplate()">
                                                    <i class="bi bi-file-earmark-plus"></i><br>
                                                    空白模板<br>
                                                    <small>导出未填写的模板</small>
                                                </button>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <button class="btn btn-outline-info w-100" onclick="exportWithExamples()">
                                                    <i class="bi bi-file-earmark-richtext"></i><br>
                                                    示例模板<br>
                                                    <small>包含填写示例</small>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 加载遮罩 -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner-border text-primary mb-3" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <h5>正在生成文档...</h5>
            <p>请稍候，这可能需要几秒钟</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 人物类型配置
        const personTypes = {
            'founder': {
                name: '企业创始人/CEO/高管',
                icon: 'bi-building',
                description: '企业领导者和决策者',
                template: {
                    sections: [
                        {
                            name: '概述',
                            fields: [
                                { name: '姓名', type: 'text', required: true, placeholder: '请输入姓名' },
                                { name: '出生日期', type: 'text', placeholder: '如：1970年3月15日' },
                                { name: '籍贯', type: 'text', placeholder: '如：山东省青岛市' },
                                { name: '职务', type: 'text', placeholder: '如：某某公司创始人、董事会主席兼CEO', example: 'XX公司创始人、董事会主席兼CEO' },
                                { name: '毕业院校', type: 'text', placeholder: '如：清华大学' },
                                { name: '民族', type: 'text', placeholder: '如：汉族' },
                                { name: '国籍', type: 'text', placeholder: '如：中国', defaultValue: '中国' },
                                { name: '就职企业', type: 'text', placeholder: '如：某某科技有限公司' }
                            ]
                        },
                        {
                            name: '人物经历',
                            type: 'timeline',
                            fields: [
                                { name: '经历', type: 'textarea', placeholder: '如：2010年，担任XX公司商业运营体系副总裁' }
                            ],
                            examples: [
                                '2010年，宋某某担任XX公司商业运营体系副总裁',
                                '2015年3月，出任XX公司销售副总裁，负责市场拓展方向',
                                '2020年1月，出任XX公司董事会主席兼CEO'
                            ]
                        },
                        {
                            name: '主要贡献',
                            type: 'list',
                            fields: [
                                { name: '贡献', type: 'textarea', placeholder: '描述具体贡献和成就' }
                            ],
                            examples: [
                                '首次提出XX理论，将XX商业模式引入中国',
                                '通过对XX行业商业模式的研究，提出了独特的XX理论，促进了行业的发展',
                                '通过对XX地方特产的定点帮扶，使100户居民脱贫致富'
                            ]
                        },
                        {
                            name: '所获荣誉',
                            type: 'list',
                            fields: [
                                { name: '荣誉', type: 'textarea', placeholder: '荣誉名称 + 颁发机构' }
                            ],
                            examples: [
                                '入选《中国企业家》最具影响力的企业领袖',
                                '入选《中国经济周刊》中国改革开放30年经济百人榜',
                                '入选2020年中国最具影响力的25位商界领袖'
                            ]
                        },
                        {
                            name: '个人生活',
                            optional: true,
                            fields: [
                                { name: '妻子', type: 'text', placeholder: '配偶信息（可选填）', optional: true },
                                { name: '孩子', type: 'text', placeholder: '子女信息（可选填）', optional: true },
                                { name: '其他家庭信息', type: 'textarea', placeholder: '其他家庭相关信息（可选填）', optional: true }
                            ]
                        },
                        {
                            name: '社会评价',
                            type: 'list',
                            fields: [
                                { name: '评价', type: 'textarea', placeholder: '评价内容（评价来源）' }
                            ],
                            examples: [
                                '宋某某是海外华人归国的典范和榜样。（王某某评）',
                                '宋某某是纯粹的读书人，既朴实无华又富于传奇。（某某杂志社评）',
                                '宋某某充满正能量的言行，能给予每一个聆听者积极向上的力量。（某某网评）'
                            ]
                        },
                        {
                            name: '参考资料',
                            type: 'list',
                            fields: [
                                { name: '链接', type: 'url', placeholder: '参考资料链接' }
                            ],
                            examples: [
                                'http://finance.people.com.cn/',
                                'https://tech.sina.com.cn/'
                            ]
                        }
                    ]
                }
            },
            'entrepreneur': {
                name: '企业家/投资人/风险投资人',
                icon: 'bi-graph-up-arrow',
                description: '投资界和商业领域专家',
                template: {
                    sections: [
                        {
                            name: '概述',
                            fields: [
                                { name: '姓名', type: 'text', required: true, placeholder: '请输入姓名' },
                                { name: '出生日期', type: 'text', placeholder: '如：1975年8月20日' },
                                { name: '籍贯', type: 'text', placeholder: '如：上海市' },
                                { name: '职务', type: 'text', placeholder: '如：某某投资管理合伙人', example: 'XX投资管理有限公司创始合伙人' },
                                { name: '毕业院校', type: 'text', placeholder: '如：北京大学、哈佛商学院' },
                                { name: '民族', type: 'text', placeholder: '如：汉族' },
                                { name: '国籍', type: 'text', placeholder: '如：中国', defaultValue: '中国' },
                                { name: '投资领域', type: 'text', placeholder: '如：科技、消费、医疗健康' }
                            ]
                        },
                        {
                            name: '投资经历',
                            type: 'timeline',
                            fields: [
                                { name: '经历', type: 'textarea', placeholder: '如：2015年，创立XX投资基金' }
                            ],
                            examples: [
                                '2010年，加入知名投资机构担任投资经理',
                                '2015年，创立XX投资基金，专注早期科技项目',
                                '2020年，成功退出多个独角兽项目，获得丰厚回报'
                            ]
                        },
                        {
                            name: '投资案例',
                            type: 'list',
                            fields: [
                                { name: '案例', type: 'textarea', placeholder: '描述重要投资项目和成果' }
                            ],
                            examples: [
                                '投资XX科技公司A轮，该公司后成为行业独角兽',
                                '领投XX消费品牌天使轮，帮助其快速扩张市场',
                                '参与XX医疗健康公司B轮投资，推动其技术创新'
                            ]
                        },
                        {
                            name: '所获荣誉',
                            type: 'list',
                            fields: [
                                { name: '荣誉', type: 'textarea', placeholder: '荣誉名称 + 颁发机构' }
                            ],
                            examples: [
                                '入选《福布斯》中国最佳创投人榜单',
                                '获得《投资界》年度最佳投资人奖',
                                '入选《财富》中国40位40岁以下商界精英'
                            ]
                        },
                        {
                            name: '个人生活',
                            optional: true,
                            fields: [
                                { name: '配偶', type: 'text', placeholder: '配偶信息（可选填）', optional: true },
                                { name: '子女', type: 'text', placeholder: '子女信息（可选填）', optional: true },
                                { name: '兴趣爱好', type: 'textarea', placeholder: '个人兴趣和爱好（可选填）', optional: true }
                            ]
                        },
                        {
                            name: '行业影响',
                            type: 'list',
                            fields: [
                                { name: '影响', type: 'textarea', placeholder: '在投资界的影响力和贡献' }
                            ],
                            examples: [
                                '推动了中国早期投资行业的发展和规范化',
                                '培养了一批优秀的创业者和投资人',
                                '积极参与行业交流，分享投资经验和理念'
                            ]
                        },
                        {
                            name: '参考资料',
                            type: 'list',
                            fields: [
                                { name: '链接', type: 'url', placeholder: '参考资料链接' }
                            ]
                        }
                    ]
                }
            },
            'creator': {
                name: '品牌主理人/创业者/自媒体创业者',
                icon: 'bi-megaphone',
                description: '品牌创造者和内容创作者',
                template: {
                    sections: [
                        {
                            name: '概述',
                            fields: [
                                { name: '姓名', type: 'text', required: true, placeholder: '请输入姓名' },
                                { name: '出生日期', type: 'text', placeholder: '如：1985年12月5日' },
                                { name: '籍贯', type: 'text', placeholder: '如：广东省深圳市' },
                                { name: '职务', type: 'text', placeholder: '如：某某品牌创始人', example: 'XX品牌创始人兼主理人' },
                                { name: '毕业院校', type: 'text', placeholder: '如：中央美术学院' },
                                { name: '民族', type: 'text', placeholder: '如：汉族' },
                                { name: '国籍', type: 'text', placeholder: '如：中国', defaultValue: '中国' },
                                { name: '品牌领域', type: 'text', placeholder: '如：时尚、美妆、生活方式' }
                            ]
                        },
                        {
                            name: '创业历程',
                            type: 'timeline',
                            fields: [
                                { name: '历程', type: 'textarea', placeholder: '如：2018年，创立个人品牌' }
                            ],
                            examples: [
                                '2016年，开始在社交媒体分享生活和创意内容',
                                '2018年，创立个人品牌，推出首个产品系列',
                                '2021年，品牌获得知名投资机构投资，快速发展'
                            ]
                        },
                        {
                            name: '品牌成就',
                            type: 'list',
                            fields: [
                                { name: '成就', type: 'textarea', placeholder: '描述品牌发展和商业成果' }
                            ],
                            examples: [
                                '品牌年销售额突破千万，成为细分领域头部品牌',
                                '在社交媒体积累百万粉丝，影响力覆盖全国',
                                '获得多个设计奖项，产品被知名博物馆收藏'
                            ]
                        },
                        {
                            name: '所获荣誉',
                            type: 'list',
                            fields: [
                                { name: '荣誉', type: 'textarea', placeholder: '荣誉名称 + 颁发机构' }
                            ],
                            examples: [
                                '入选《时尚芭莎》年度影响力人物',
                                '获得中国设计红星奖',
                                '入选《创业邦》30位30岁以下创业者'
                            ]
                        },
                        {
                            name: '个人生活',
                            optional: true,
                            fields: [
                                { name: '生活状态', type: 'text', placeholder: '个人生活状态（可选填）', optional: true },
                                { name: '创作理念', type: 'textarea', placeholder: '个人创作和设计理念（可选填）', optional: true },
                                { name: '兴趣爱好', type: 'textarea', placeholder: '个人兴趣和爱好（可选填）', optional: true }
                            ]
                        },
                        {
                            name: '社会影响',
                            type: 'list',
                            fields: [
                                { name: '影响', type: 'textarea', placeholder: '社会影响力和文化贡献' }
                            ],
                            examples: [
                                '通过品牌传播正能量价值观，影响年轻一代',
                                '积极参与公益活动，关注环保和可持续发展',
                                '推动了国潮文化的发展和传播'
                            ]
                        },
                        {
                            name: '参考资料',
                            type: 'list',
                            fields: [
                                { name: '链接', type: 'url', placeholder: '参考资料链接' }
                            ]
                        }
                    ]
                }
            },
            'director': {
                name: '上市公司董事/独立董事',
                icon: 'bi-briefcase',
                description: '公司治理和监督专家',
                template: {
                    sections: [
                        {
                            name: '概述',
                            fields: [
                                { name: '姓名', type: 'text', required: true, placeholder: '请输入姓名' },
                                { name: '出生日期', type: 'text', placeholder: '如：1965年4月10日' },
                                { name: '籍贯', type: 'text', placeholder: '如：江苏省南京市' },
                                { name: '职务', type: 'text', placeholder: '如：某某公司独立董事', example: 'XX股份有限公司独立董事' },
                                { name: '毕业院校', type: 'text', placeholder: '如：复旦大学、沃顿商学院' },
                                { name: '民族', type: 'text', placeholder: '如：汉族' },
                                { name: '国籍', type: 'text', placeholder: '如：中国', defaultValue: '中国' },
                                { name: '专业领域', type: 'text', placeholder: '如：财务、法律、战略管理' }
                            ]
                        },
                        {
                            name: '职业经历',
                            type: 'timeline',
                            fields: [
                                { name: '经历', type: 'textarea', placeholder: '如：2005年，担任XX公司财务总监' }
                            ],
                            examples: [
                                '1990年，开始在知名会计师事务所工作',
                                '2005年，担任XX上市公司财务总监',
                                '2015年，开始担任多家上市公司独立董事'
                            ]
                        },
                        {
                            name: '董事职务',
                            type: 'list',
                            fields: [
                                { name: '职务', type: 'textarea', placeholder: '描述担任的董事职务和公司' }
                            ],
                            examples: [
                                '担任XX科技股份有限公司独立董事（2018-至今）',
                                '担任XX银行股份有限公司独立董事（2020-至今）',
                                '曾任XX制造业集团董事（2015-2020）'
                            ]
                        },
                        {
                            name: '专业贡献',
                            type: 'list',
                            fields: [
                                { name: '贡献', type: 'textarea', placeholder: '在公司治理方面的专业贡献' }
                            ],
                            examples: [
                                '参与制定公司重大战略决策，推动业务转型升级',
                                '完善公司内控制度，提升风险管理水平',
                                '积极履行独立董事职责，维护中小股东权益'
                            ]
                        },
                        {
                            name: '所获荣誉',
                            type: 'list',
                            fields: [
                                { name: '荣誉', type: 'textarea', placeholder: '荣誉名称 + 颁发机构' }
                            ],
                            examples: [
                                '获得中国上市公司协会优秀独立董事奖',
                                '入选《董事会》杂志年度最佳独立董事',
                                '获得中国注册会计师协会杰出贡献奖'
                            ]
                        },
                        {
                            name: '个人生活',
                            optional: true,
                            fields: [
                                { name: '家庭情况', type: 'text', placeholder: '家庭基本情况（可选填）', optional: true },
                                { name: '学术成果', type: 'textarea', placeholder: '学术研究和著作（可选填）', optional: true },
                                { name: '社会职务', type: 'textarea', placeholder: '其他社会职务（可选填）', optional: true }
                            ]
                        },
                        {
                            name: '行业评价',
                            type: 'list',
                            fields: [
                                { name: '评价', type: 'textarea', placeholder: '行业内的评价和认可' }
                            ],
                            examples: [
                                '被誉为公司治理领域的专家，具有丰富的实践经验',
                                '在财务管理和风险控制方面有着深厚的专业功底',
                                '积极推动中国公司治理制度的完善和发展'
                            ]
                        },
                        {
                            name: '参考资料',
                            type: 'list',
                            fields: [
                                { name: '链接', type: 'url', placeholder: '参考资料链接' }
                            ]
                        }
                    ]
                }
            }
        };

        // 全局变量
        let currentPersonType = 'founder';
        let formData = {};
        let referenceCounter = 1;

        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializePersonTypeCards();
            initializeForm();
            loadSavedData();
            updatePreview();
            updateProgress();
        });

        // 初始化人物类型卡片
        function initializePersonTypeCards() {
            const container = document.getElementById('personTypeCards');
            Object.keys(personTypes).forEach((typeKey, index) => {
                const type = personTypes[typeKey];
                const isActive = typeKey === currentPersonType ? 'active' : '';
                
                container.innerHTML += `
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="type-card ${isActive}" onclick="selectPersonType('${typeKey}')">
                            <i class="${type.icon}"></i>
                            <h5>${type.name}</h5>
                            <p class="text-muted">${type.description}</p>
                        </div>
                    </div>
                `;
            });
        }

        // 选择人物类型
        function selectPersonType(typeKey) {
            currentPersonType = typeKey;
            
            // 更新卡片状态
            document.querySelectorAll('.type-card').forEach(card => {
                card.classList.remove('active');
            });
            event.target.closest('.type-card').classList.add('active');
            
            // 重新初始化表单
            initializeForm();
            updatePreview();
            updateProgress();
        }

        // 初始化表单
        function initializeForm() {
            const container = document.getElementById('formSections');
            const template = personTypes[currentPersonType].template;
            
            container.innerHTML = '';
            
            template.sections.forEach((section, sectionIndex) => {
                let sectionHtml = `
                    <div class="form-section">
                        <div class="section-header">
                            <i class="bi bi-${getSectionIcon(section.name)}"></i> ${section.name}
                            ${section.optional ? '<span class="badge bg-secondary ms-2">可选</span>' : ''}
                        </div>
                        <div class="section-content">
                `;

                if (section.type === 'timeline' || section.type === 'list') {
                    sectionHtml += createDynamicSection(section, sectionIndex);
                } else {
                    section.fields.forEach((field, fieldIndex) => {
                        sectionHtml += createFormField(field, sectionIndex, fieldIndex);
                    });
                }

                sectionHtml += `
                        </div>
                    </div>
                `;
                
                container.innerHTML += sectionHtml;
            });
        }

        // 创建表单字段
        function createFormField(field, sectionIndex, fieldIndex) {
            const fieldId = `field_${sectionIndex}_${fieldIndex}`;
            const requiredClass = field.required ? 'required-field' : '';
            const requiredAttr = field.required ? 'required' : '';
            
            let fieldHtml = `
                <div class="form-group">
                    <label for="${fieldId}" class="form-label ${requiredClass}">${field.name}</label>
            `;

            if (field.type === 'textarea') {
                fieldHtml += `
                    <textarea class="form-control" id="${fieldId}" placeholder="${field.placeholder}" ${requiredAttr} oninput="updateFormData('${fieldId}', this.value)">${field.defaultValue || ''}</textarea>
                `;
            } else if (field.type === 'url') {
                fieldHtml += `
                    <input type="url" class="form-control" id="${fieldId}" placeholder="${field.placeholder}" ${requiredAttr} oninput="updateFormData('${fieldId}', this.value)" value="${field.defaultValue || ''}">
                `;
            } else {
                fieldHtml += `
                    <input type="text" class="form-control" id="${fieldId}" placeholder="${field.placeholder}" ${requiredAttr} oninput="updateFormData('${fieldId}', this.value)" value="${field.defaultValue || ''}">
                `;
            }

            if (field.example) {
                fieldHtml += `<div class="help-text"><i class="bi bi-lightbulb"></i> 示例：${field.example}</div>`;
            }

            fieldHtml += `</div>`;
            return fieldHtml;
        }

        // 创建动态部分（时间线和列表）
        function createDynamicSection(section, sectionIndex) {
            const sectionId = `dynamic_${sectionIndex}`;
            let html = `
                <div id="${sectionId}">
                    <div class="mb-3">
                        <button type="button" class="add-item-btn" onclick="addDynamicItem('${sectionId}', ${sectionIndex})">
                            <i class="bi bi-plus-circle"></i> 添加${section.name === '人物经历' ? '经历' : section.name === '投资经历' ? '经历' : section.name === '创业历程' ? '历程' : '条目'}
                        </button>
                    </div>
                    <div id="${sectionId}_items">
                        <!-- 动态添加的项目 -->
                    </div>
                </div>
            `;

            if (section.examples) {
                html += `
                    <div class="mt-3">
                        <h6><i class="bi bi-lightbulb"></i> 参考示例：</h6>
                        <ul class="list-unstyled">
                `;
                section.examples.forEach(example => {
                    html += `<li class="text-muted"><i class="bi bi-arrow-right"></i> ${example}</li>`;
                });
                html += `
                        </ul>
                    </div>
                `;
            }

            return html;
        }

        // 添加动态项目
        function addDynamicItem(sectionId, sectionIndex) {
            const container = document.getElementById(`${sectionId}_items`);
            const itemIndex = container.children.length;
            const itemId = `${sectionId}_item_${itemIndex}`;
            
            const itemHtml = `
                <div class="${sectionId.includes('timeline') ? 'timeline-item' : 'list-item'}" id="${itemId}">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h6 class="mb-0">条目 ${itemIndex + 1}</h6>
                        <button type="button" class="remove-item-btn" onclick="removeDynamicItem('${itemId}', '${sectionId}')">
                            <i class="bi bi-trash"></i> 删除
                        </button>
                    </div>
                    <textarea class="form-control" placeholder="请输入内容..." oninput="updateFormData('${itemId}', this.value)"></textarea>
                    <div class="mt-2">
                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="addReference('${itemId}')">
                            <i class="bi bi-link-45deg"></i> 添加参考文献
                        </button>
                    </div>
                </div>
            `;
            
            container.innerHTML += itemHtml;
            updateProgress();
        }

        // 删除动态项目
        function removeDynamicItem(itemId, sectionId) {
            document.getElementById(itemId).remove();
            delete formData[itemId];
            updatePreview();
            updateProgress();
        }

        // 添加参考文献
        function addReference(itemId) {
            const textarea = document.querySelector(`#${itemId} textarea`);
            const referenceTag = `[${referenceCounter}]`;
            textarea.value += referenceTag;
            referenceCounter++;
            updateFormData(itemId, textarea.value);
        }

        // 更新表单数据
        function updateFormData(fieldId, value) {
            formData[fieldId] = value;
            saveData();
            updatePreview();
            updateProgress();
        }

        // 更新预览
        function updatePreview() {
            const previewContainer = document.getElementById('previewSections');
            const template = personTypes[currentPersonType].template;
            
            // 设置标题
            const personName = formData['field_0_0'] || '姓名';
            document.getElementById('previewTitle').textContent = `${personName} - 人物百科词条`;
            
            let previewHtml = '';
            
            template.sections.forEach((section, sectionIndex) => {
                previewHtml += `
                    <div class="preview-section">
                        <h3>${section.name}</h3>
                `;

                if (section.type === 'timeline' || section.type === 'list') {
                    const sectionId = `dynamic_${sectionIndex}`;
                    const items = Object.keys(formData).filter(key => key.startsWith(sectionId));
                    
                    if (items.length > 0) {
                        if (section.type === 'timeline') {
                            previewHtml += '<div class="timeline-preview">';
                            items.forEach(itemKey => {
                                if (formData[itemKey]) {
                                    previewHtml += `<p><strong>•</strong> ${formData[itemKey]}</p>`;
                                }
                            });
                            previewHtml += '</div>';
                        } else {
                            previewHtml += '<ul>';
                            items.forEach(itemKey => {
                                if (formData[itemKey]) {
                                    previewHtml += `<li>${formData[itemKey]}</li>`;
                                }
                            });
                            previewHtml += '</ul>';
                        }
                    } else {
                        previewHtml += '<p class="text-muted"><em>暂无内容</em></p>';
                    }
                } else {
                    // 基本信息展示
                    if (section.name === '概述') {
                        const overview = generateOverviewText(section, sectionIndex);
                        previewHtml += `<p>${overview}</p>`;
                    } else {
                        section.fields.forEach((field, fieldIndex) => {
                            const fieldId = `field_${sectionIndex}_${fieldIndex}`;
                            const value = formData[fieldId];
                            if (value) {
                                previewHtml += `<p><strong>${field.name}：</strong>${value}</p>`;
                            }
                        });
                    }
                }

                previewHtml += '</div>';
            });
            
            previewContainer.innerHTML = previewHtml;
        }

        // 生成概述文本
        function generateOverviewText(section, sectionIndex) {
            const fields = {};
            section.fields.forEach((field, fieldIndex) => {
                const fieldId = `field_${sectionIndex}_${fieldIndex}`;
                fields[field.name] = formData[fieldId] || '';
            });

            let overview = '';
            if (fields['姓名']) {
                overview += fields['姓名'];
                if (fields['出生日期']) overview += `，${fields['出生日期']}出生`;
                if (fields['籍贯']) overview += `，${fields['籍贯']}人`;
                if (fields['民族']) overview += `，${fields['民族']}`;
                if (fields['国籍']) overview += `，${fields['国籍']}国籍`;
                if (fields['毕业院校']) overview += `，毕业于${fields['毕业院校']}`;
                if (fields['职务']) overview += `，现任${fields['职务']}`;
                if (fields['就职企业'] || fields['投资领域'] || fields['品牌领域'] || fields['专业领域']) {
                    const extra = fields['就职企业'] || fields['投资领域'] || fields['品牌领域'] || fields['专业领域'];
                    overview += `，专注${extra}领域`;
                }
                overview += '。';
            }
            
            return overview || '<em class="text-muted">请填写基本信息</em>';
        }

        // 更新进度
        function updateProgress() {
            const template = personTypes[currentPersonType].template;
            let totalFields = 0;
            let filledFields = 0;

            template.sections.forEach((section, sectionIndex) => {
                if (section.type === 'timeline' || section.type === 'list') {
                    const sectionId = `dynamic_${sectionIndex}`;
                    const items = Object.keys(formData).filter(key => key.startsWith(sectionId) && formData[key]);
                    totalFields += Math.max(1, items.length);
                    filledFields += items.length;
                } else {
                    section.fields.forEach((field, fieldIndex) => {
                        if (!field.optional) {
                            totalFields++;
                            const fieldId = `field_${sectionIndex}_${fieldIndex}`;
                            if (formData[fieldId]) {
                                filledFields++;
                            }
                        }
                    });
                }
            });

            const progress = totalFields > 0 ? Math.round((filledFields / totalFields) * 100) : 0;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `${progress}%`;
        }

        // 获取章节图标
        function getSectionIcon(sectionName) {
            const iconMap = {
                '概述': 'person-circle',
                '人物经历': 'clock-history',
                '投资经历': 'graph-up',
                '创业历程': 'rocket-takeoff',
                '职业经历': 'briefcase',
                '主要贡献': 'award',
                '投资案例': 'bullseye',
                '品牌成就': 'trophy',
                '专业贡献': 'gear',
                '董事职务': 'building',
                '所获荣誉': 'medal',
                '个人生活': 'house-heart',
                '社会评价': 'chat-quote',
                '行业影响': 'broadcast',
                '社会影响': 'globe',
                '行业评价': 'star',
                '参考资料': 'link-45deg'
            };
            return iconMap[sectionName] || 'info-circle';
        }

        // 保存数据到本地存储
        function saveData() {
            localStorage.setItem(`百科矩阵_biography_${currentPersonType}`, JSON.stringify(formData));
        }

        // 加载保存的数据
        function loadSavedData() {
            const savedData = localStorage.getItem(`百科矩阵_biography_${currentPersonType}`);
            if (savedData) {
                formData = JSON.parse(savedData);
                // 恢复表单值
                Object.keys(formData).forEach(fieldId => {
                    const element = document.getElementById(fieldId);
                    if (element) {
                        element.value = formData[fieldId];
                    }
                });
            }
        }

        // 导出为Word文档
        async function exportToWord() {
            showLoading();
            
            try {
                const content = generateExportContent();
                const blob = new Blob([content], { 
                    type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' 
                });
                
                const personName = formData['field_0_0'] || '人物';
                const fileName = `${personName}_百科矩阵_人物词条.docx`;
                
                saveAs(blob, fileName);
            } catch (error) {
                console.error('导出Word失败:', error);
                alert('导出失败，请重试');
            } finally {
                hideLoading();
            }
        }

        // 导出为PDF
        async function exportToPDF() {
            showLoading();
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const content = generateExportContent(true);
                const lines = content.split('\n');
                
                let yPosition = 20;
                const lineHeight = 10;
                const pageHeight = doc.internal.pageSize.height;
                
                lines.forEach(line => {
                    if (yPosition > pageHeight - 20) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    doc.text(line, 20, yPosition);
                    yPosition += lineHeight;
                });
                
                const personName = formData['field_0_0'] || '人物';
                doc.save(`${personName}_百科矩阵_人物词条.pdf`);
            } catch (error) {
                console.error('导出PDF失败:', error);
                alert('导出失败，请重试');
            } finally {
                hideLoading();
            }
        }

        // 导出为文本
        function exportToText() {
            const content = generateExportContent(true);
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            
            const personName = formData['field_0_0'] || '人物';
            const fileName = `${personName}_百科矩阵_人物词条.txt`;
            
            saveAs(blob, fileName);
        }

        // 导出空白模板
        function exportEmptyTemplate() {
            const template = personTypes[currentPersonType].template;
            let content = `${personTypes[currentPersonType].name} - 百科矩阵·人物词条模板\n\n`;
            
            template.sections.forEach(section => {
                content += `${section.name}：\n`;
                if (section.type === 'timeline' || section.type === 'list') {
                    content += `[请在此处添加${section.name}内容]\n\n`;
                    if (section.examples) {
                        content += `参考示例：\n`;
                        section.examples.forEach(example => {
                            content += `• ${example}\n`;
                        });
                        content += '\n';
                    }
                } else {
                    section.fields.forEach(field => {
                        content += `${field.name}：[请填写]\n`;
                    });
                    content += '\n';
                }
            });
            
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            saveAs(blob, `${personTypes[currentPersonType].name}_百科矩阵_空白模板.txt`);
        }

        // 导出带示例模板
        function exportWithExamples() {
            const template = personTypes[currentPersonType].template;
            let content = `${personTypes[currentPersonType].name} - 百科矩阵·人物词条模板（含示例）\n\n`;
            
            template.sections.forEach(section => {
                content += `${section.name}：\n`;
                if (section.type === 'timeline' || section.type === 'list') {
                    if (section.examples) {
                        section.examples.forEach(example => {
                            content += `• ${example}\n`;
                        });
                    } else {
                        content += `[请在此处添加${section.name}内容]\n`;
                    }
                    content += '\n';
                } else {
                    section.fields.forEach(field => {
                        const exampleText = field.example || field.placeholder || '[请填写]';
                        content += `${field.name}：${exampleText}\n`;
                    });
                    content += '\n';
                }
            });
            
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            saveAs(blob, `${personTypes[currentPersonType].name}_百科矩阵_示例模板.txt`);
        }

        // 生成导出内容
        function generateExportContent(isPlainText = false) {
            const template = personTypes[currentPersonType].template;
            const personName = formData['field_0_0'] || '姓名';
            let content = `${personName} - 百科矩阵·人物词条\n\n`;
            
            template.sections.forEach((section, sectionIndex) => {
                content += `${section.name}\n`;
                content += isPlainText ? '─'.repeat(20) + '\n' : '\n';
                
                if (section.type === 'timeline' || section.type === 'list') {
                    const sectionId = `dynamic_${sectionIndex}`;
                    const items = Object.keys(formData).filter(key => key.startsWith(sectionId));
                    
                    if (items.length > 0) {
                        items.forEach(itemKey => {
                            if (formData[itemKey]) {
                                content += `• ${formData[itemKey]}\n`;
                            }
                        });
                    } else {
                        content += '[暂无内容]\n';
                    }
                } else {
                    if (section.name === '概述') {
                        const overview = generateOverviewText(section, sectionIndex);
                        content += `${overview}\n`;
                    } else {
                        section.fields.forEach((field, fieldIndex) => {
                            const fieldId = `field_${sectionIndex}_${fieldIndex}`;
                            const value = formData[fieldId] || '';
                            content += `${field.name}：${value}\n`;
                        });
                    }
                }
                
                content += '\n';
            });
            
            content += `\n生成时间：${new Date().toLocaleString()}\n`;
            content += `生成工具：百科矩阵·人物词条模板生成器\n`;
            
            return content;
        }

        // 显示加载遮罩
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        // 隐藏加载遮罩
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // 标签页切换事件
        document.addEventListener('shown.bs.tab', function (event) {
            if (event.target.id === 'preview-tab') {
                updatePreview();
            }
        });
    </script>
</body>
</html>